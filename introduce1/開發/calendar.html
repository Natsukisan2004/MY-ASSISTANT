<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ã‚·ãƒ³ãƒ—ãƒ«ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</title>
    <link rel="stylesheet" href="style.css" />
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
</head>
<body>


<!-- â–¼â–¼â–¼ ãƒ˜ãƒƒãƒ€ãƒ¼ï¼†ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ ã“ã“ã‹ã‚‰ â–¼â–¼â–¼ -->
<header id="mainHeader" class="main-header">
  <h1>ãƒã‚¤ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h1>
  <nav class="global-nav">
    <ul class="nav-list">
      <li><a href="calendar.html" class="nav-link active" id="navCalendar">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</a></li>
      <li><a href="profile.html" class="nav-link" id="navProfile">ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</a></li>
      <li><a href="settings.html" class="nav-link" id="navSettings">è¨­å®š</a></li>

    </ul>
  </nav>
</header>
<!-- â–²â–²â–² ãƒ˜ãƒƒãƒ€ãƒ¼ï¼†ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ ã“ã“ã¾ã§ â–²â–²â–² -->

<script>
    const userUId = localStorage.getItem("userUId");
    if (!userUId) {
      alert('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„');
      window.location.href = 'index.html';
    }
    
</script>

<div class="welcome-area">
  <div id="welcomeMsg"></div>

  <div class="controls-group">
    <div class="search-form-container">
        <input type="search" id="searchInput" placeholder="äºˆå®šã‚’æ¤œç´¢...">
        <button id="searchBtn">æ¤œç´¢</button>
    </div>
    <div class="view-btn-group">
      <button class="view-btn" data-view="day">æ—¥</button>
      <button class="view-btn" data-view="week">é€±</button>
      <button class="view-btn active" data-view="month">æœˆ</button>
    </div>
    <button id="todayBtn" class="button-primary">ä»Šæ—¥ã«æˆ»ã‚‹</button>
  </div>
</div>

<div class="wrapper">
    <div class="calendar-container">
        <div class="calendar-header">
            <button id="prevBtn">â†</button>
            <h2 id="current-date"></h2>
            <button id="nextBtn">â†’</button>
        </div>
        <div class="weekdays">
            <div>æ—¥</div>
            <div>æœˆ</div>
            <div>ç«</div>
            <div>æ°´</div>
            <div>æœ¨</div>
            <div>é‡‘</div>
            <div>åœŸ</div>
        </div>
      
        <div id="calendar" class="calendar-grid view-container"></div>
        <div id="week-view" class="view-container hidden"></div>
        <div id="day-view" class="view-container hidden"></div>
    </div>
    
    </div>
    
    <!-- äº‹ä»¶æ·»åŠ ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="eventModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>äºˆå®šã‚’è¿½åŠ </h3>
        <form id="eventForm">
            <div class="form-group">
                <label for="eventName">ã‚¤ãƒ™ãƒ³ãƒˆå:</label>
                <input type="text" id="eventName" name="eventName" required placeholder="ä¾‹: ãƒãƒ¼ãƒ ãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°">
            </div>
        <form id="eventForm">
            <div class="form-group">
                <label for="eventDate">é–‹å§‹æ—¥:</label>
                <input type="date" id="eventDate" name="eventDate" required placeholder="ä¾‹: 2025-06-24" title="æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„">
            </div>

            <div class="form-group-time-range">
                <div class="form-group">
                    <label for="eventStartTime">é–‹å§‹æ™‚åˆ»:</label>
                    <input type="time" id="eventStartTime" name="eventStartTime" required>
                </div>

            <div class="form-group">
                <label for="eventEndDate">çµ‚äº†æ—¥:</label>
                <input type="date" id="eventEndDate" name="eventEndDate" required placeholder="ä¾‹: 2025-06-25" title="çµ‚äº†æ—¥ã‚’é¸æŠã—ã¦ãã ã•ã„">
            </div>

                <div class="form-group">
                    <label for="eventEndTime">çµ‚äº†æ™‚åˆ»:</label>
                    <input type="time" id="eventEndTime" name="eventEndTime" required>
                </div>
            </div>
            
            <div class="form-group">
                <label for="eventLocation">å ´æ‰€:</label>
                <input type="text" id="eventLocation" name="eventLocation" required placeholder="ä¾‹: ä¼šè­°å®¤A" title="å ´æ‰€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
            </div>
            <div class="form-group">
                <label for="eventNote">ãƒ¡ãƒ¢:</label>
                <textarea id="eventNote" name="eventNote" placeholder="ä¾‹: æ‰“ã¡åˆã‚ã›å†…å®¹" title="ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
            </div>
            <div class="form-group">
                <label>ã‚«ãƒ©ãƒ¼:</label>
                <div class="color-picker">
                    <input type="radio" name="eventColor" value="#1a73e8" id="color1" checked>
                    <label for="color1" style="background-color: #1a73e8" title="é’"></label>
                    
                    <input type="radio" name="eventColor" value="#d93025" id="color2">
                    <label for="color2" style="background-color: #d93025" title="èµ¤"></label>
                    
                    <input type="radio" name="eventColor" value="#f9ab00" id="color3">
                    <label for="color3" style="background-color: #f9ab00" title="é»„"></label>
                    
                    <input type="radio" name="eventColor" value="#137333" id="color4">
                    <label for="color4" style="background-color: #137333" title="ç·‘"></label>
                    
                    <input type="radio" name="eventColor" value="#a142f4" id="color5">
                    <label for="color5" style="background-color: #a142f4" title="ç´«"></label>
                </div>
            </div>
            <button type="submit">ä¿å­˜</button>
        </form>
        <button id="deleteEventBtn" style="display:none;">å‰Šé™¤</button>
    </div>
</div>
                    

<!-- ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ -->
<button id="chatToggle">
    <span>ğŸ’¬</span>
    <span>æ™ºèƒ½åŠ©æ‰‹</span>
</button>
<div id="chatWindow" class="chat-window hidden">
    <div id="chatMessages" class="chat-messages"></div>
    
    <!-- å›¾ç‰‡æ‹–æ‹½åŒºåŸŸ -->
    <div id="imageDropZone" class="image-drop-zone hidden">
        <div class="drop-zone-content">
            <div class="drop-zone-icon">ğŸ“·</div>
            <div class="drop-zone-text">æ‹–æ‹½å›¾ç‰‡ â€¢ ç‚¹å‡»ä¸Šä¼  â€¢ Ctrl+Vç²˜è´´</div>
            <div class="drop-zone-subtext">æ”¯æŒ JPG, PNG, GIF æ ¼å¼ â€¢ æ–‡ä»¶å¤§å° â‰¤ 1MB</div>
        </div>
    </div>
    
    <!-- å›¾ç‰‡é¢„è§ˆåŒºåŸŸ -->
    <div id="imagePreview" class="image-preview hidden">
        <div class="preview-header">
            <span class="preview-title">å›¾ç‰‡é¢„è§ˆ</span>
            <button type="button" id="removeImage" class="remove-image-btn">Ã—</button>
        </div>
        <img id="previewImg" src="" alt="é¢„è§ˆå›¾ç‰‡" />
        <div class="ocr-status">
            <span id="ocrStatusText">å‡†å¤‡è¯†åˆ«å›¾ç‰‡ä¸­çš„æ–‡å­—...</span>
            <div id="ocrProgress" class="ocr-progress hidden">
                <div class="progress-bar"></div>
            </div>
        </div>
    </div>
    
    <form id="chatForm">
        <div class="input-group">
            <input type="text" id="userInput" placeholder="è¯·å‘Šè¯‰æˆ‘æ‚¨çš„æ—¥ç¨‹å®‰æ’..." />
            <input type="file" id="imageInput" accept="image/*" style="display: none;" />
            <button type="button" id="imageBtn" title="ä¸Šä¼ å›¾ç‰‡è¯†åˆ«æ–‡å­—">ğŸ“·</button>
            <button type="button" id="micBtn" title="è¯­éŸ³è¾“å…¥">ğŸ¤</button>
            <button type="submit" id="sendBtn">â€œsend"</button>
        </div>
    </form>
</div>

<!-- APIè¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="apiSettingModal" class="modal">
  <div class="modal-content">
    <span class="close" id="closeApiSetting">&times;</span>
    <h3>AI & OCR APIè¨­å®š</h3>
    <form id="apiSettingForm">
      <div class="api-section">
        <h4>ğŸ¤– AIèŠå¤©è®¾ç½®</h4>
        <div class="form-group">
          <label>API URL</label>
          <input type="text" id="apiUrlInput" placeholder="https://openrouter.ai/api/v1/chat/completions" required>
          <small class="form-help">æ”¯æŒOpenRouterã€OpenAIç­‰å…¼å®¹API</small>
        </div>
        <div class="form-group">
          <label>API Key</label>
          <input type="password" id="apiKeyInput" placeholder="sk-or-..." required>
          <small class="form-help">æ‚¨çš„AIæœåŠ¡APIå¯†é’¥</small>
        </div>
        <div class="form-group">
          <label>Model</label>
          <input type="text" id="modelInput" placeholder="deepseek/deepseek-r1-0528:free" required>
          <small class="form-help">æ¨è: deepseek/deepseek-r1, openai/gpt-4</small>
        </div>
      </div>
      
      <div class="api-section">
        <h4>ğŸ“· OCRå›¾ç‰‡è¯†åˆ«è®¾ç½®</h4>
        <div class="form-group">
          <label>OCR API Key</label>
          <input type="password" id="ocrApiKeyInput" placeholder="å…è´¹ç‰ˆæœ‰é™åˆ¶ï¼Œå»ºè®®ç”³è¯·ä¸“å±å¯†é’¥">
          <small class="form-help">
            OCR.space APIå¯†é’¥ - 
            <a href="https://ocr.space/ocrapi" target="_blank" style="color: #667eea;">å…è´¹ç”³è¯·</a>
            (å¯é€‰ï¼Œç³»ç»Ÿæä¾›å…è´¹é¢åº¦)
          </small>
        </div>
      </div>
      
      <div class="api-section">
        <h4>ğŸŒ è¯­è¨€è®¾ç½®</h4>
        <div class="form-group">
          <label>OCR & AI è¯­è¨€</label>
          <select id="aiLanguageSelect">
            <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª (Japanese)</option>
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡ (Chinese)</option>
          </select>
          <small class="form-help">åŒæ—¶è®¾ç½®OCRè¯†åˆ«è¯­è¨€å’ŒAIå›å¤è¯­è¨€</small>
        </div>
      </div>
      
      <button type="submit">ä¿å­˜è®¾ç½®</button>
    </form>
  </div>
</div>
<button id="openApiSetting" style="position:fixed;bottom:20px;left:20px;z-index:1001;">âš™ï¸ APIè®¾ç½®</button>

<script type="module" src="JS/main.js"></script>
<script>
  
  // æ—¢å­˜ã® deleteEvent é–¢æ•°ã®ã‚ã¨ã€ã“ã“ã«è¿½åŠ ğŸ‘‡
  // ã€ŒÃ—ã€ãƒœã‚¿ãƒ³ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
  document.querySelector('.modal .close').addEventListener('click', () => {
    document.getElementById('eventModal').classList.remove('show');
  });

  // ãƒ¢ãƒ¼ãƒ€ãƒ«ã®å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚é–‰ã˜ã‚‰ã‚Œã‚‹ã‚ˆã†ã«
  document.getElementById('eventModal').addEventListener('click', (e) => {
    if (e.target.id === 'eventModal') {
      document.getElementById('eventModal').classList.remove('show');
    }
  });
</script>
<script>
  // ãƒ˜ãƒƒãƒ€ãƒ¼ç”»åƒå¤‰æ›´æ©Ÿèƒ½
  document.addEventListener('DOMContentLoaded', () => {
    const changeHeaderImgBtn = document.getElementById('changeHeaderImgBtn');
    const headerImgInput = document.getElementById('headerImgInput');
    const mainHeader = document.getElementById('mainHeader');

    // ä¿å­˜ç”»åƒãŒã‚ã‚Œã°é©ç”¨
    const savedImg = localStorage.getItem('headerBgImg');
    if (savedImg && mainHeader) {
      mainHeader.style.backgroundImage = `url('${savedImg}')`;
    }

    if (changeHeaderImgBtn && headerImgInput && mainHeader) {
      changeHeaderImgBtn.addEventListener('click', () => {
        headerImgInput.click();
      });
      headerImgInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(ev) {
          mainHeader.style.backgroundImage = `url('${ev.target.result}')`;
          localStorage.setItem('headerBgImg', ev.target.result);
        };
        reader.readAsDataURL(file);
      });
    }
  });
</script>

<div id="searchResultsModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>æ¤œç´¢çµæœ</h3>
        <div id="searchResultsContainer">
            </div>
    </div>
</div>

</body>
</html>